<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: backend/test-api-endpoints.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: backend/test-api-endpoints.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>#!/usr/bin/env node

/**
 * Test API Endpoints (requires server to be running)
 */

const BASE_URL = 'http://localhost:3000/api'

// First, we need to login to get a token
async function login() {
  try {
    const response = await fetch(`${BASE_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email: 'admin@bdo.com',
        password: 'admin123'
      })
    })
    
    if (response.ok) {
      const data = await response.json()
      return data.token
    } else {
      console.log('Login failed, trying to create test user...')
      return null
    }
  } catch (error) {
    console.log('Login error:', error.message)
    return null
  }
}

async function testEndpoint(name, url, token) {
  try {
    const headers = { 'Content-Type': 'application/json' }
    if (token) {
      headers['Authorization'] = `Bearer ${token}`
    }
    
    const response = await fetch(url, { headers })
    const data = await response.json()
    
    if (response.ok) {
      console.log(`\n‚úÖ ${name}`)
      console.log(`   Status: ${response.status}`)
      if (Array.isArray(data)) {
        console.log(`   Records: ${data.length}`)
        if (data.length > 0 &amp;&amp; data.length &lt;= 5) {
          console.log(`   Sample:`, JSON.stringify(data[0], null, 2).substring(0, 150))
        }
      } else if (typeof data === 'object') {
        console.log(`   Response keys:`, Object.keys(data).join(', '))
      }
      return { success: true, data }
    } else {
      console.log(`\n‚ùå ${name}`)
      console.log(`   Status: ${response.status}`)
      console.log(`   Error:`, data.error || data.message)
      return { success: false, error: data }
    }
  } catch (error) {
    console.log(`\n‚ùå ${name}`)
    console.log(`   Error: ${error.message}`)
    return { success: false, error: error.message }
  }
}

async function runTests() {
  console.log('üß™ Testing Service Catalog API Endpoints')
  console.log('=========================================\n')
  
  // Test 1: Health check (no auth needed)
  await testEndpoint('Health Check', `${BASE_URL}/health`, null)
  
  // Test 2: Login
  console.log('\nüîê Attempting login...')
  const token = await login()
  
  if (!token) {
    console.log('\n‚ö†Ô∏è  Could not get auth token. Some tests will fail.')
    console.log('   To test authenticated endpoints:')
    console.log('   1. Ensure a user exists in the database')
    console.log('   2. Login via POST /api/auth/login')
    console.log('   3. Use the token in Authorization header')
    return
  }
  
  console.log('‚úÖ Login successful\n')
  
  // Test 3: Entity Codes
  await testEndpoint('Get Entity Codes', `${BASE_URL}/entity-codes`, token)
  
  // Test 4: Global Catalog
  await testEndpoint('Get Global Catalog', `${BASE_URL}/service-catalog/global`, token)
  
  // Test 5: Entity Catalog
  await testEndpoint('Get Entity Catalog (BDO_AL_NISF)', `${BASE_URL}/service-catalog/entity/BDO_AL_NISF`, token)
  
  // Test 6: Service Types with entity filter
  await testEndpoint('Get Service Types (filtered by entity)', `${BASE_URL}/integration/service-types?entity=BDO_AL_NISF`, token)
  
  console.log('\n‚úÖ API endpoint tests completed!')
}

// Use native fetch (Node 18+)
if (typeof fetch === 'undefined') {
  console.log('‚ùå This script requires Node.js 18+ with native fetch support')
  console.log('   Or install node-fetch: npm install node-fetch')
  process.exit(1)
}

runTests().catch(console.error)
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#BASE_URL">BASE_URL</a></li><li><a href="global.html#testDatabaseTables">testDatabaseTables</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sat Feb 07 2026 12:14:58 GMT+0300 (Arabian Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
