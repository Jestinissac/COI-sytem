# Unique Codes Reference - COI and PRMS Context

## COI System Unique Codes

### 1. COI Request ID
- **Purpose**: Unique identifier for each COI request
- **Format**: To be determined (e.g., `COI-2025-001`, `COI-REQ-2025-00001`)
- **Generation**: Auto-generated when request is created
- **Uniqueness**: Must be unique across all COI requests
- **Usage**: 
  - Tracking requests through workflow
  - Reference in communications
  - Audit trail
  - Reporting

### 2. Engagement Code / Finance Code
- **Purpose**: Unique, permanent code that authorizes project creation in PRMS
- **Format**: `ENG-{YEAR}-{SERVICE_TYPE}-{SEQUENTIAL_NUMBER}`
  - Example: `ENG-2025-TAX-00142`
  - Year: 4 digits (e.g., 2025)
  - Service Type: Abbreviation (e.g., TAX, AUD, ADV, ACC)
  - Sequential Number: 5 digits (e.g., 00142)
- **Generation**: 
  - Auto-generated by Finance Team after Partner approval
  - Generated in Finance Coding phase (Step 5)
- **Uniqueness**: Must be unique and permanent (never reused)
- **Usage**:
  - Required for PRMS project creation
  - Included in proposal documents
  - Validated by PRMS before project creation
  - Tracked in Partner dashboard
  - Referenced in engagement letters
- **Validation**: PRMS validates against COI authorization table
- **Status**: Cannot be deleted, only marked as inactive

### 3. Existing Engagement Code (Reference)
- **Purpose**: Reference to previous engagement when client is "Existing"
- **Format**: Same as Engagement Code format
- **Source**: From previous COI requests or PRMS projects
- **Usage**: 
  - Filled in COI request form when client is "Existing"
  - Used to retrieve service history
  - Used to identify partner in charge
- **Validation**: Must exist in system (COI or PRMS)

### 4. Client Code (from PRMS Client Master)
- **Purpose**: Unique identifier for clients in PRMS Client Master
- **Format**: To be determined (e.g., `CLT-001`, `CLIENT-2024-001`)
- **Source**: PRMS Client Master database
- **Usage**:
  - Client selection dropdown in COI request form
  - Linking COI requests to clients
  - Preventing duplicate client entries
  - No free-text client names allowed
- **Validation**: Must exist in PRMS Client Master

### 5. Commercial Registration Number
- **Purpose**: Legal registration identifier for clients
- **Format**: Varies by jurisdiction (e.g., Kuwait CR numbers)
- **Source**: PRMS Client Master
- **Usage**: 
  - Part of client information in COI form
  - Used for validation and duplicate detection
  - Required for compliance checks

---

## PRMS System Unique Codes

### 1. Project ID
- **Purpose**: Unique identifier for projects in PRMS
- **Format**: Auto-generated using BDO logic, references Service Year
  - Example format: `PRJ-2025-001`, `P-2025-AUD-001`
  - Service Year: Year of service delivery
- **Generation**: 
  - Auto-generated when project is created
  - Generated after Engagement Code validation
- **Uniqueness**: Must be unique per project
- **Usage**:
  - Project tracking
  - Resource allocation
  - Timesheet mapping
  - Billing and invoicing
  - Reporting

### 2. Engagement Code (from COI)
- **Purpose**: Authorization code from COI system
- **Format**: `ENG-{YEAR}-{SERVICE_TYPE}-{SEQUENTIAL_NUMBER}`
- **Source**: COI system (Finance Team generation)
- **Validation**: 
  - PRMS validates against COI authorization table
  - Project creation blocked if invalid or missing
  - Must be in "Active" status in COI
- **Usage**:
  - Required for project creation
  - Links PRMS project to COI request
  - Authorization check before project operations

### 3. Client Code (PRMS Client Master)
- **Purpose**: Unique identifier in PRMS Client Master
- **Format**: Same as COI Client Code (shared reference)
- **Usage**:
  - Client Master data
  - Project-client relationship
  - Billing and invoicing
  - Historical tracking

### 4. Task ID
- **Purpose**: Unique identifier for tasks within projects
- **Format**: To be determined (e.g., `TASK-{PROJECT_ID}-001`)
- **Generation**: Auto-generated when task is created
- **Usage**:
  - Task tracking
  - Timesheet entry mapping
  - Resource allocation
  - Project management

### 5. Team ID
- **Purpose**: Unique identifier for teams
- **Format**: To be determined (e.g., `TEAM-001`, `TEAM-AUD-001`)
- **Usage**:
  - Team assignment to projects
  - Resource management
  - Timesheet tracking

---

## Code Relationships and Dependencies

### COI to PRMS Flow:
```
COI Request ID → Engagement Code → PRMS Project ID
     ↓                ↓                    ↓
  Request        Authorization        Project
  Creation       (Finance Team)       Creation
```

### Code Validation Chain:
1. **COI Request Created** → COI Request ID generated
2. **Finance Coding** → Engagement Code generated (linked to COI Request ID)
3. **PRMS Project Creation** → Engagement Code validated against COI
4. **PRMS Project Created** → Project ID generated (linked to Engagement Code)

### Code Uniqueness Rules:
- **COI Request ID**: Unique within COI system
- **Engagement Code**: Unique across entire system (COI + PRMS)
- **Project ID**: Unique within PRMS system
- **Client Code**: Unique within PRMS Client Master (shared with COI)

---

## Code Format Specifications

### Engagement Code Format Details:
```
ENG-{YEAR}-{SERVICE_TYPE}-{SEQUENTIAL_NUMBER}

Components:
- Prefix: "ENG-" (fixed)
- Year: 4 digits (YYYY)
- Service Type: 3-4 letter abbreviation
  - TAX = Tax Services
  - AUD = Audit & Assurance
  - ADV = Advisory
  - ACC = Accounting
  - OTH = Other Regulated Services
- Sequential Number: 5 digits (zero-padded, e.g., 00142)

Examples:
- ENG-2025-TAX-00142
- ENG-2025-AUD-00001
- ENG-2025-ADV-00250
```

### Service Type Abbreviations:
- **AUD**: Audit & Assurance
- **ADV**: Advisory
- **TAX**: Tax Services
- **ACC**: Accounting
- **OTH**: Other Regulated Services

---

## Database Schema for Codes

### COI Tables:
```sql
coi_requests
  - request_id (PK) - COI Request ID
  - engagement_code (FK) - Links to coi_engagement_codes
  - client_code (FK) - Links to PRMS Client Master
  - status
  - created_date

coi_engagement_codes
  - engagement_code (PK) - Unique Engagement Code
  - request_id (FK) - Links to coi_requests
  - service_type
  - year
  - sequential_number
  - generated_date
  - generated_by (Finance Team user)
  - status (Active/Inactive)
```

### PRMS Tables:
```sql
projects
  - project_id (PK) - Project ID
  - engagement_code (FK) - Links to COI engagement_codes
  - client_code (FK) - Links to Client Master
  - service_year
  - status

client_master
  - client_code (PK) - Client Code
  - client_name
  - commercial_registration
  - status
```

---

## Code Generation Logic

### Engagement Code Generation (Finance Team):
1. Determine Service Type abbreviation from COI request
2. Get current year
3. Query last sequential number for year + service type
4. Increment sequential number
5. Format: `ENG-{YEAR}-{SERVICE_TYPE}-{SEQUENTIAL_NUMBER}`
6. Validate uniqueness
7. Save to `coi_engagement_codes` table
8. Link to COI request

### Project ID Generation (PRMS):
1. Validate Engagement Code exists and is Active in COI
2. Determine Service Year from project details
3. Apply BDO logic for Project ID format
4. Generate unique Project ID
5. Link to Engagement Code
6. Save to `projects` table

---

## Code Validation Rules

### Engagement Code Validation (PRMS):
- ✅ Must exist in COI `coi_engagement_codes` table
- ✅ Status must be "Active"
- ✅ Must be linked to approved COI request
- ✅ Must not be expired or cancelled
- ❌ Project creation blocked if validation fails

### Client Code Validation (COI):
- ✅ Must exist in PRMS Client Master
- ✅ Status must be "Active"
- ❌ Free-text client names not allowed
- ❌ Request blocked if client doesn't exist (redirect to PRMS admin)

---

## Code Usage in Workflows

### COI Workflow:
1. **Request Creation**: COI Request ID generated
2. **Compliance Review**: Uses COI Request ID for tracking
3. **Partner Approval**: Uses COI Request ID for tracking
4. **Finance Coding**: Engagement Code generated, linked to COI Request ID
5. **Admin Execution**: Engagement Code included in proposal
6. **PRMS Integration**: Engagement Code sent to PRMS for validation

### PRMS Workflow:
1. **Project Creation**: Engagement Code entered/validated
2. **Project ID Generated**: After Engagement Code validation
3. **Resource Mapping**: Tasks and Teams linked to Project ID
4. **Operations**: All operations reference Project ID

---

## Prototype Implementation Notes

### For Prototype:
- All codes use simplified formats for demonstration
- Sequential numbers start from 1 for each type
- Validation logic is simulated (not real database checks)
- Code formats can be adjusted based on actual requirements
- Sample codes provided in seed data

### Sample Codes for Prototype:
- COI Request ID: `COI-2025-001`, `COI-2025-002`
- Engagement Code: `ENG-2025-TAX-00001`, `ENG-2025-AUD-00001`
- Project ID: `PRJ-2025-001`, `PRJ-2025-002`
- Client Code: `CLT-001`, `CLT-002`


